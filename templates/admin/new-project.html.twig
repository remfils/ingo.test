{% extends 'admin/admin.html.twig' %}
{% set active_page = 'new-project' %}

{% block main_title %}
    New Project:
{% endblock %}

{% block content %}
    {% if success_message is not empty %}
        <h2 class="success-message">
            {{ success_message }}
        </h2>
    {% endif %}

    <div class="container">

        <form action="" method="POST" class="form-horizontal" enctype="multipart/form-data">
            <div class="form-group">
                <label for="logo" class="col-sm-2 control-label">Logo:</label>
                <div class="col-sm-10">
                    <input type="file" id="logo" name="logo" class="form-control" />
                </div>
            </div>

            <div class="form-group">
                <label for="name" class="col-sm-2 control-label">Name:</label>
                <div class="col-sm-10">
                    <input type="text" id="name" name="name" class="form-control" />
                </div>
            </div>

            <div class="form-group">
                <label for="year" class="col-sm-2 control-label">Year:</label>
                <div class="col-sm-10">
                    <input type="text" id="year" name="year" class="form-control" />
                </div>
            </div>

            <div class="form-group">
                <label for="preview_url" class="col-sm-2 control-label">Preview url:</label>
                <div class="col-sm-10">
                    <input type="text" id="preview_url" name="preview_url" class="form-control" />
                </div>
            </div>

            <div class="form-group">
                <div class="col-md-2"></div>

                <div id="ProjectInfoTable" class="col-md-9">
                    <div id="field-1" class="form-group">
                        <div class="col-lg-4 no-float">
                            <label for="field-name-1">Field name:</label>
                            <input type="text" id="field-name-1" name="field_name_1" class="form-control" />
                        </div>
                        <div class="col-lg-4 no-float">
                            <label for="field-value-1">Field value:</label>
                            <input type="text" id="field-value-1" name="field_value_1" class="form-control" />
                        </div>
                        <div class="col-sm-4 no-float" style="vertical-align: bottom">
                            <span id="field-remove-1" class="btn btn-sm btn-danger remove">Remove</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-1">
                    <span id="AddButton" type="button" class="btn btn-success" value="add" style="margin-top: 25px">add</span>
                </div>
            </div>

            <div class="form-group">
                <label for="color" class="col-sm-2 control-label">Color:</label>
                <div class="col-sm-10">
                    <input type="text" id="color" name="color" class="form-control" />
                </div>
            </div>

            <div class="form-group">
                <label for="description" class="col-sm-2 control-label">Description:</label>
                <div class="col-sm-10">
                    <textarea type="text" id="description" name="description" class="form-control">
                    </textarea>
                </div>
            </div>

            <div class="form-group">
                <input type="submit" class="pull-right btn btn-success" value="Input Button" / />
            </div>
        </form>

    </div>
{% endblock %}

{% block scripts %}

<script src="{{ app.asset_path }}/js/jquery-2.2.3.min.js"></script>
<script>
    var field_count = 1;

    var createInfoRow = function(row_type) {
        var field_container = document.createElement('div');
        field_container.classList.add('col-md-4');
        field_container.classList.add('no-float');

        var field_id = ["field", row_type, field_count].join('-');

        var label = document.createElement('label');
        label.htmlFor = field_id;
        label.innerHTML = "Field " + row_type + ":";

        var input = document.createElement('input');
        input.type = "text";
        input.id = field_id;
        input.name = ["field", row_type, field_count].join('_');
        input.classList.add("form-control");

        field_container.appendChild(label);
        field_container.appendChild(input);

        return field_container;
    };



    $('#AddButton').click(function(){
        field_count ++;

        var container = document.createElement('div');
        container.classList.add('form-group');
        container.id = "field-" + field_count;

        var name_row = createInfoRow('name');
        container.appendChild(name_row);

        var value_row = createInfoRow('value');
        container.appendChild(value_row);

        var field_container = document.createElement('div');
        field_container.classList.add('col-md-4');
        field_container.classList.add('no-float');
        field_container.style['vertical-align'] = "bottom";
        var btn = document.createElement('span');
        btn.id = "field-remove-" + field_count;
        btn.innerHTML = "Remove";
        btn.classList.add('btn');
        btn.classList.add('btn-sm');
        btn.classList.add('btn-danger');
        btn.classList.add('remove');
        field_container.appendChild(btn);
        container.appendChild(field_container);

        var table = $("#ProjectInfoTable")[0];
        table.appendChild(container);
    });

    $("#ProjectInfoTable").on('click', ".remove", function(){
        var id = this.id.split("-").pop();

        var $field = $('#field-' + id);

        if ( $field.parent().children().length > 1 ) {
            $field.remove();
        }
        else {
            alert('There has to be at least one field');
        }
    });
</script>

{% endblock %}